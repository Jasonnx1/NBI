public class VoronoiMap
{

int nVoronoi = 1000;
ArrayList<Node> nodes;
Node focal;


float[][] points;
Voronoi myVoronoi;

MPolygon[] myRegions;
float[][] myEdges;


int minDistance = 0;
int minIndex = 0;



VoronoiMap()
{
  points = new float[nVoronoi][2];
  nodes = new ArrayList<Node>();
  generateMap();
  
  myVoronoi = new Voronoi( points );
  myRegions = myVoronoi.getRegions();
  myEdges = myVoronoi.getEdges();
}

void generateMap()
{

    for(int i=0; i < nVoronoi; i++)
    {
        nodes.add( new Node() );    
        points[i][0] = nodes.get(i).pos.x;
        points[i][1] = nodes.get(i).pos.y;
    }
  
}

void generateNoise()
{
  float r = 200;
  float theta = PI;
  float increment = 0.02;
  float xoff = 0.0;
  float yoff = 0.0;
  
  noiseSeed(hour() + minute() + second() + millis());

  for(int i = 0; i < 360; i++)
  {
    
  xoff += increment;
  yoff += increment; 
  theta += PI/180; 
  r = noise(xoff, yoff) * 300;
 
  location.x = r * cos(theta) + width/2; 
  location.y = r * sin(theta) + height/2;

  nearestNode(location).attribut = 1;
  
  pushMatrix();
  translate(width/2, height/2);
  point(location.x,location.y);
  popMatrix();
  
  }
  
  focal = nearestNode(new PVector(width/2, height/2)); // Sets the focal point as a Volcano
  focal.attribut = 5;
  
  for(Node n : nodes)
  {
   
    if(n.attribut == 1)
    {
      
      // TODO: Generation intérieur de l'île
      
    }
    
  }

  
  assignAttribut();
  
}

Node nearestNode(PVector loc)
{
  Node tempNode = null;
  
  float dist = 0;
  for(int i = 0; i < nodes.size(); i++)
  {
    if(dist == 0)
    {
     
      dist = PVector.dist(loc, nodes.get(i).pos);
      tempNode = nodes.get(i);
      
    }
    else
    {
     
      if( dist > PVector.dist(loc, nodes.get(i).pos) )
      {
        dist = PVector.dist(loc, nodes.get(i).pos);
        tempNode = nodes.get(i);
      }
      
    }
    
    
    
  }
  
  
  return tempNode;
  
}

void assignAttribut()
{
  
  for(int i = 0; i < nVoronoi; i++)
  {
    nodes.get(i).generate(); 
  }
  
}

void display(PApplet applet)
{
    background(0);
   
   // For each pixel
   
   stroke(2);
   
    for(int i=0; i<voronoi.myRegions.length; i++)
    {
      fill(nodes.get(i).c);
      voronoi.myRegions[i].draw(applet); // draw this shape
    }

    
  for(int i=0; i<myEdges.length; i++)
  {
    float startX = myEdges[i][0];
    float startY = myEdges[i][1];
    float endX = myEdges[i][2];
    float endY = myEdges[i][3];
    line( startX, startY, endX, endY );
  }
  
  /*
  fill(0);
  for(int i = 0 ; i < nodes.size(); i++)
  {
    
    
    ellipse(nodes.get(i).pos.x, nodes.get(i).pos.y, 2, 2);
    
    
  
  }
  */
    

  
}


}
